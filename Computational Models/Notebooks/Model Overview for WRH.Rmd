---
title: "Phage Host Range Modeling"
author: "ATB"
date: "1/5/2022"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

``` {r load-packages, include=FALSE}
library(ggplot2)
library(dplyr)
library(tidyr)
library(deSolve)
library(ggpubr)
library(data.table)
library(reshape)
library(tidyverse)
library(rootSolve)
```
## Background

ATB has been working on resource-explicit and phenomenological LV modeling of phage host range in a four-species system. This Rmarkdown file contains an overview of the models used, the standard parameters, and important outputs to help understand the predictions of the models.

## The resource explicit model equations

Below are the resource-explicit model equations, contained as functions for use by deSolve's ode, for three conditions: cooperating hosts, competing hosts, and neutral (non-interacting) hosts. All three conditions contain equations tracking sensitive, dead and resistant E coli or S enterica, one to three nutrients that are either cross-fed or competed for, and three phage with variable host range (gen = generalist, sp = specialist on S enterica, sp2 = specialist on E coli).

``` {r resource-explicit-model-equations}

#cooperative equations
Coop <- function(t,n,parms){
  with(as.list(c(t,n,parms)), {
    
    if (Es < 1e-20){
      Es = 0
    }
    if (Er < 1e-20){
      Er = 0
    }
    if (Ss < 1e-20){
      Ss = 0
    }
    if (Sr < 1e-20){
      Sr = 0
    }
    if (lcts < 1e-50){
      lcts = 0
    }
    if (ac < 1e-50){
      ac = 0
    }
    if (met < 1e-50){
      met = 0
    }
    
    gEs = Es * mu_e * (lcts / (lcts + k_e_lactose)) * (met / (met + k_e_met))
    dEs = gEs - (Es*gen*adsorp_gen) - (Es*sp2*adsorp_sp2)
    dEdead = (Es*gen*adsorp_gen) + (Es*sp2*adsorp_sp2) 
    dEr = Er * mu_e * (lcts / (lcts + k_e_lactose)) * (met / (met + k_e_met)) 
    
    gSs = Ss * mu_s * (ac / (ac + k_s_acetate))
    dSs = gSs - (Ss*sp*adsorp_sp) - (Ss*gen*adsorp_gen) 
    dSdead = (Ss*sp*adsorp_sp) + (Ss*gen*adsorp_gen) 
    dSr = Sr * mu_s * (ac / (ac + k_s_acetate)) 
    
    dlcts =  (-(gEs+dEr) * c_e_lactose) 
    dmet = (-(gEs+dEr) * c_e_met)  + ((gSs+dSr) * p_s_met) 
    dac = (-(gSs+dSr) * c_s_acetate) + ((gEs+dEr) * p_e_acetate)
    
    dgen = (gen * burst_gen * Es * adsorp_gen) + (gen * burst_gen * Ss * adsorp_gen) 
    dsp = (sp * burst_sp * Ss * adsorp_sp) 
    dsp2 = (sp2 * burst_sp2 * Es * adsorp_sp2)
    
    return(list(c(dEs, dEr, dSs, dSr, dgen, dsp, dsp2, dEdead, dSdead, dlcts, dmet, dac)))
  })
}

#competitive equations
Comp <- function(t,n,parms){
  with(as.list(c(t,n,parms)), {
    if (Es < 1e-20){
      Es = 0
    }
    if (Er < 1e-20){
      Er = 0
    }
    if (Ss < 1e-20){
      Ss = 0
    }
    if (Sr < 1e-20){
      Sr = 0
    }
    if (lcts < 1e-50){
      lcts = 0
    }
    
    gEs = Es * mu_e * (lcts / (lcts + k_e_lactose)) 
    dEs = gEs - (Es*gen*adsorp_gen) - (Es*sp2*adsorp_sp2) 
    dEdead = (Es*gen*adsorp_gen) + (Es*sp2*adsorp_sp2) 
    dEr = Er * mu_e * (lcts / (lcts + k_e_lactose))
    
    gSs = Ss * mu_s * (lcts / (lcts + k_s_lactose))
    dSs = gSs - (Ss*sp*adsorp_sp) - (Ss*gen*adsorp_gen)
    dSdead = (Ss*sp*adsorp_sp) + (Ss*gen*adsorp_gen)
    dSr = Sr * mu_s * (lcts / (lcts + k_s_lactose))
    
    dlcts = (-(gEs+dEr) * c_e_lactose) - ((gSs+dSr) * c_s_lactose)
    
    dgen = (gen * burst_gen * Es * adsorp_gen) + (gen * burst_gen * Ss * adsorp_gen)
    dsp = (sp * burst_sp * Ss * adsorp_sp)
    dsp2 = (sp2 * burst_sp2 * Es * adsorp_sp2)
    
    return(list(c(dEs, dEr, dSs, dSr, dgen, dsp, dsp2, dEdead, dSdead, dlcts)))
  })
}

#neutral equations
Neutral <- function(t,n,parms){
  with(as.list(c(t,n,parms)), {
    
    if (Es < 1e-20){
      Es = 0
    }
    if (Er < 1e-20){
      Er = 0
    }
    if (Ss < 1e-20){
      Ss = 0
    }
    if (Sr < 1e-20){
      Sr = 0
    }
    if (lcts < 1e-50){
      lcts = 0
    }
    if (ac < 1e-50){
      ac = 0
    }
    
    gEs = Es * mu_e * (lcts / (lcts + k_e_lactose)) 
    dEs = gEs - (Es*gen*adsorp_gen) - (Es*sp2*adsorp_sp2)
    dEdead = (Es*gen*adsorp_gen) + (Es*sp2*adsorp_sp2)
    dEr = Er * mu_e * (lcts / (lcts + k_e_lactose))
    
    gSs = Ss * mu_s * (ac / (ac + k_s_acetate))
    dSs = gSs - (Ss*sp*adsorp_sp) - (Ss*gen*adsorp_gen)
    dSdead = (Ss*sp*adsorp_sp) + (Ss*gen*adsorp_gen)
    dSr = Sr * mu_s * (ac / (ac + k_s_acetate))
    
    dlcts = (-(gEs+dEr) * c_e_lactose)
    dac = (-(gSs+dSr) * c_s_acetate)
    
    dgen = (gen * burst_gen * Es * adsorp_gen) + (gen * burst_gen * Ss * adsorp_gen)
    dsp = (sp * burst_sp * Ss * adsorp_sp)
    dsp2 = (sp2 * burst_sp2 * Es * adsorp_sp2)
    
    return(list(c(dEs, dEr, dSs, dSr, dgen, dsp, dsp2, dEdead, dSdead, dlcts, dac)))
  })
}
```

### Resource-explicit standard constants

Standard constants were derived both from experimental work by ATB (growth rate of E coli and S enterica in glucose+methionine media) or taken from previous models used by LF for phage simulations. 

``` {r standard-constants}
#COOPERATIVE BACTERIAL CONSTANTS
#growth
mu_e = 0.5
mu_s = 0.2

#consumption
k_e_lactose = 7e-7 #consumption per e cell
c_e_lactose = 2e-12#amount used to make one e cell
k_e_met = 3e-7
c_e_met = 2e-14
k_s_acetate = 3e-7
c_s_acetate = 3e-13

#production
p_e_acetate = 1e-13 #produced per e cell
p_s_met = 10e-14

#COMPETITIVE BACTERIAL CONSTANTS
#growth (constants are reduced by 0.05x to extend time to reach equilibrium)
mu_s = 0.0521922 #1.043844*0.05 based on experimental work
mu_e = 0.03044743 #0.6089485*0.05 based on experimental work 

#consumption
k_e_lactose = 7e-7
k_s_lactose = 7e-7
c_e_lactose = 2e-12
c_s_lactose = 2e-12

#NEUTRAL BACTERIAL CONSTANTS
#growth
mu_e = 0.40175 #0.8035*0.5, e rate of growth in lcts+met media
mu_s = 0.5359195 #1.071839*0.5, s rate of growth in gluc media

#consumption
k_e_lactose = 7e-7
k_s_acetate = 7e-7
c_e_lactose = 2e-12
c_s_acetate = 2e-12

#phage constants (used for all conditions)
burst_gen = 5
burst_sp = 5
burst_sp2 = 5
adsorp_gen = 1e-8
adsorp_sp = 1e-8
adsorp_sp2 = 1e-8
```

### Simulation Set Points

Below is the standard starting density and timeframe for all simulations. Resistant E coli and S enterica are not included in any of the analysis as it currently stands. Bacteria are always seeded at a density of 1e4. Generally speaking, simulations are run either without phage or with two phage seeded at a low density of 1 (gen = 1, sp = 1). Sp2 (T7) is largely ignored in favor of sp (P22vir), to recapitulate our in vitro experiments. 

``` {r simulation-set-points}
#time frame for all simulations
time = seq(from = 0 , to = 1e5, by = 10)

#cooperative
start_density = c(Es = 1e4, Er = 0, Ss = 1e4, Sr = 0, gen = 1, sp = 1, sp2 = 0, Edead = 0, Sdead = 0, lcts = 1e-3, met = 1e-12, ac = 0)

#competitive
start_density = c(Es = 1e4, Er = 0, Ss = 1e4, Sr = 0, gen = 1, sp = 1, sp2 = 0, Edead = 0, Sdead = 0, lcts = 1e-3)

#neutral
start_density = c(Es = 1e4, Er = 0, Ss = 1e4, Sr = 0, gen = 1, sp = 1, sp2 = 0, Edead = 0, Sdead = 0, lcts = 1e-3, ac = 1e-3)
```

### Basic Dynamics Without Phage

To get a sense of the equilibrial dynamics of the model without phage, plots are included below of each condition. 

**Cooperation**

```{r coop-plot-without-phage, echo = FALSE}
#cooperative plot
parameters_Coop = c(mu_e = 0.5,
                    k_e_lactose = 7e-7,#speed of eating
                    k_e_met = 3e-7,#formerly 3e-7
                    c_e_lactose = 2e-12,#amount used to make one cell
                    p_e_acetate = 1e-13,#amount produced by one cell
                    c_s_acetate = 3e-13,#formerly 3e-13
                    p_s_met = 10e-14, #formerly 10e-14
                    c_e_met = 2e-14,#formerly 2e-14
                    mu_s = 0.2,   
                    k_s_acetate = 3e-7, #formerly 3e-7
                    
                    burst_gen = 5,
                    burst_sp = 5,
                    burst_sp2 = 5,
                    adsorp_gen = 1e-8,
                    adsorp_sp = 1e-8,
                    adsorp_sp2 = 1e-8
)

Coop <- function(t,n,parms){
  with(as.list(c(t,n,parms)), {
    
    if (Es < 1e-20){
      Es = 0
    }
    if (Er < 1e-20){
      Er = 0
    }
    if (Ss < 1e-20){
      Ss = 0
    }
    if (Sr < 1e-20){
      Sr = 0
    }
    if (lcts < 1e-50){
      lcts = 0
    }
    if (ac < 1e-50){
      ac = 0
    }
    if (met < 1e-50){
      met = 0
    }
    
    gEs = Es * mu_e * (lcts / (lcts + k_e_lactose)) * (met / (met + k_e_met))
    dEs = gEs - (Es*gen*adsorp_gen) - (Es*sp2*adsorp_sp2)
    dEdead = (Es*gen*adsorp_gen) + (Es*sp2*adsorp_sp2) 
    dEr = Er * mu_e * (lcts / (lcts + k_e_lactose)) * (met / (met + k_e_met)) 
    
    gSs = Ss * mu_s * (ac / (ac + k_s_acetate))
    dSs = gSs - (Ss*sp*adsorp_sp) - (Ss*gen*adsorp_gen) 
    dSdead = (Ss*sp*adsorp_sp) + (Ss*gen*adsorp_gen) 
    dSr = Sr * mu_s * (ac / (ac + k_s_acetate)) 
    
    dlcts =  (-(gEs+dEr) * c_e_lactose) 
    dmet = (-(gEs+dEr) * c_e_met)  + ((gSs+dSr) * p_s_met) 
    dac = (-(gSs+dSr) * c_s_acetate) + ((gEs+dEr) * p_e_acetate)
    
    dgen = (gen * burst_gen * Es * adsorp_gen) + (gen * burst_gen * Ss * adsorp_gen) 
    dsp = (sp * burst_sp * Ss * adsorp_sp) 
    dsp2 = (sp2 * burst_sp2 * Es * adsorp_sp2)
    
    return(list(c(dEs, dEr, dSs, dSr, dgen, dsp, dsp2, dEdead, dSdead, dlcts, dmet, dac)))
  })
}
time = seq(from = 0 , to = 1e5, by = 10)
start_density = c(Es = 1e4, Er = 0, Ss = 1e4, Sr = 0, gen = 0, sp = 0, sp2 = 0, Edead = 0, Sdead = 0,
                  lcts = 1e-3, met = 1e-12, ac = 0)
out=ode(y=start_density,
          times=time,
          func=Coop,
          parms = parameters_Coop,
          rtol = 1e-14)
plot(out)
```

**Competition**

``` {r comp-plot-without-phage, echo = FALSE}
parameters_Comp = c(mu_s = 0.0521922,#1.043844*0.05 based on experimental work
                    k_e_lactose = 7e-7,
                    c_e_lactose = 2e-12,
                    c_s_lactose = 2e-12,
                    mu_e = 0.03044743,  #0.6089485*0.05 based on experimental work 
                    k_s_lactose = 7e-7,
                    
                    burst_gen = 5,
                    burst_sp = 5,
                    burst_sp2 = 5,
                    adsorp_gen = 1e-8,
                    adsorp_sp = 1e-8,
                    adsorp_sp2 = 1e-8
)

Comp <- function(t,n,parms){
  with(as.list(c(t,n,parms)), {
    if (Es < 1e-20){
      Es = 0
    }
    if (Er < 1e-20){
      Er = 0
    }
    if (Ss < 1e-20){
      Ss = 0
    }
    if (Sr < 1e-20){
      Sr = 0
    }
    if (lcts < 1e-50){
      lcts = 0
    }
    
    gEs = Es * mu_e * (lcts / (lcts + k_e_lactose)) 
    dEs = gEs - (Es*gen*adsorp_gen) - (Es*sp2*adsorp_sp2) 
    dEdead = (Es*gen*adsorp_gen) + (Es*sp2*adsorp_sp2) 
    dEr = Er * mu_e * (lcts / (lcts + k_e_lactose))
    
    gSs = Ss * mu_s * (lcts / (lcts + k_s_lactose))
    dSs = gSs - (Ss*sp*adsorp_sp) - (Ss*gen*adsorp_gen)
    dSdead = (Ss*sp*adsorp_sp) + (Ss*gen*adsorp_gen)
    dSr = Sr * mu_s * (lcts / (lcts + k_s_lactose))
    
    dlcts = (-(gEs+dEr) * c_e_lactose) - ((gSs+dSr) * c_s_lactose)
    
    dgen = (gen * burst_gen * Es * adsorp_gen) + (gen * burst_gen * Ss * adsorp_gen)
    dsp = (sp * burst_sp * Ss * adsorp_sp)
    dsp2 = (sp2 * burst_sp2 * Es * adsorp_sp2)
    
    return(list(c(dEs, dEr, dSs, dSr, dgen, dsp, dsp2, dEdead, dSdead, dlcts)))
  })
}
time = seq(from = 0 , to = 1e5, by = 10)
start_density = c(Es = 1e4, Er = 0, Ss = 1e4, Sr = 0, gen = 0, sp = 0, sp2 = 0, Edead = 0, Sdead = 0, lcts = 1e-3)
out=ode(y=start_density,
          times=time,
          func=Comp,
          parms = parameters_Comp,
          rtol = 1e-14)
plot(out)
```

**Neutral**

``` {r neutral-plot-without-phage, echo=FALSE}
parameters_Neutral = c(mu_e = 0.40175,#0.8035*0.5, e rate of growth in lcts+met media
                       k_e_lactose = 7e-7,
                       c_e_lactose = 2e-12,
                       c_s_acetate = 2e-12,#formerly 3e-13
                       mu_s = 0.5359195, #1.071839*0.5, s rate of growth in gluc media
                       k_s_acetate = 7e-7, #formerly 3e-7
                       
                       burst_gen = 5,
                       burst_sp = 5,
                       burst_sp2 = 5,
                       adsorp_gen = 1e-8,
                       adsorp_sp = 1e-8,
                       adsorp_sp2 = 1e-8
)

Neutral <- function(t,n,parms){
  with(as.list(c(t,n,parms)), {
    
    if (Es < 1e-20){
      Es = 0
    }
    if (Er < 1e-20){
      Er = 0
    }
    if (Ss < 1e-20){
      Ss = 0
    }
    if (Sr < 1e-20){
      Sr = 0
    }
    if (lcts < 1e-50){
      lcts = 0
    }
    if (ac < 1e-50){
      ac = 0
    }
    
    gEs = Es * mu_e * (lcts / (lcts + k_e_lactose)) 
    dEs = gEs - (Es*gen*adsorp_gen) - (Es*sp2*adsorp_sp2)
    dEdead = (Es*gen*adsorp_gen) + (Es*sp2*adsorp_sp2)
    dEr = Er * mu_e * (lcts / (lcts + k_e_lactose))
    
    gSs = Ss * mu_s * (ac / (ac + k_s_acetate))
    dSs = gSs - (Ss*sp*adsorp_sp) - (Ss*gen*adsorp_gen)
    dSdead = (Ss*sp*adsorp_sp) + (Ss*gen*adsorp_gen)
    dSr = Sr * mu_s * (ac / (ac + k_s_acetate))
    
    dlcts = (-(gEs+dEr) * c_e_lactose)
    dac = (-(gSs+dSr) * c_s_acetate)
    
    dgen = (gen * burst_gen * Es * adsorp_gen) + (gen * burst_gen * Ss * adsorp_gen)
    dsp = (sp * burst_sp * Ss * adsorp_sp)
    dsp2 = (sp2 * burst_sp2 * Es * adsorp_sp2)
    
    return(list(c(dEs, dEr, dSs, dSr, dgen, dsp, dsp2, dEdead, dSdead, dlcts, dac)))
  })
}
time = seq(from = 0 , to = 1e5, by = 10)
start_density = c(Es = 1e4, Er = 0, Ss = 1e4, Sr = 0, gen = 0, sp = 0, sp2 = 0, Edead = 0, Sdead = 0, lcts = 1e-3, ac = 1e-3)
out=ode(y=start_density,
          times=time,
          func=Neutral,
          parms = parameters_Neutral,
          rtol = 1e-14)
plot(out)
```

Using these set parameters, in the absence of phage, non-interacting bacterial species converge toward a 50:50 ratio, cooperating bacterial species converge toward a 75:25 (E:S) ratio, and competing bacterial species converge toward a 1:99 (E:S) ratio.

### Basic Dynamics With Phage

When we compete gen and sp against each other at a low starting density (gen = 1, sp = 1), our results diverge from the phage-free equilibrium. Here, burst size and attachment rate are identical for each phage. We are not yet imposing cost.

**Cooperation**

```{r coop-plot-with-phage, echo = FALSE}
#cooperative plot
parameters_Coop = c(mu_e = 0.5,
                    k_e_lactose = 7e-7,#speed of eating
                    k_e_met = 3e-7,#formerly 3e-7
                    c_e_lactose = 2e-12,#amount used to make one cell
                    p_e_acetate = 1e-13,#amount produced by one cell
                    c_s_acetate = 3e-13,#formerly 3e-13
                    p_s_met = 10e-14, #formerly 10e-14
                    c_e_met = 2e-14,#formerly 2e-14
                    mu_s = 0.2,   
                    k_s_acetate = 3e-7, #formerly 3e-7
                    
                    burst_gen = 5,
                    burst_sp = 5,
                    burst_sp2 = 5,
                    adsorp_gen = 1e-8,
                    adsorp_sp = 1e-8,
                    adsorp_sp2 = 1e-8
)

Coop <- function(t,n,parms){
  with(as.list(c(t,n,parms)), {
    
    if (Es < 1e-20){
      Es = 0
    }
    if (Er < 1e-20){
      Er = 0
    }
    if (Ss < 1e-20){
      Ss = 0
    }
    if (Sr < 1e-20){
      Sr = 0
    }
    if (lcts < 1e-50){
      lcts = 0
    }
    if (ac < 1e-50){
      ac = 0
    }
    if (met < 1e-50){
      met = 0
    }
    
    gEs = Es * mu_e * (lcts / (lcts + k_e_lactose)) * (met / (met + k_e_met))
    dEs = gEs - (Es*gen*adsorp_gen) - (Es*sp2*adsorp_sp2)
    dEdead = (Es*gen*adsorp_gen) + (Es*sp2*adsorp_sp2) 
    dEr = Er * mu_e * (lcts / (lcts + k_e_lactose)) * (met / (met + k_e_met)) 
    
    gSs = Ss * mu_s * (ac / (ac + k_s_acetate))
    dSs = gSs - (Ss*sp*adsorp_sp) - (Ss*gen*adsorp_gen) 
    dSdead = (Ss*sp*adsorp_sp) + (Ss*gen*adsorp_gen) 
    dSr = Sr * mu_s * (ac / (ac + k_s_acetate)) 
    
    dlcts =  (-(gEs+dEr) * c_e_lactose) 
    dmet = (-(gEs+dEr) * c_e_met)  + ((gSs+dSr) * p_s_met) 
    dac = (-(gSs+dSr) * c_s_acetate) + ((gEs+dEr) * p_e_acetate)
    
    dgen = (gen * burst_gen * Es * adsorp_gen) + (gen * burst_gen * Ss * adsorp_gen) 
    dsp = (sp * burst_sp * Ss * adsorp_sp) 
    dsp2 = (sp2 * burst_sp2 * Es * adsorp_sp2)
    
    return(list(c(dEs, dEr, dSs, dSr, dgen, dsp, dsp2, dEdead, dSdead, dlcts, dmet, dac)))
  })
}
time = seq(from = 0 , to = 1e5, by = 10)
start_density = c(Es = 1e4, Er = 0, Ss = 1e4, Sr = 0, gen = 1, sp = 1, sp2 = 0, Edead = 0, Sdead = 0,
                  lcts = 1e-3, met = 1e-12, ac = 0)
out=ode(y=start_density,
          times=time,
          func=Coop,
          parms = parameters_Coop,
          rtol = 1e-14)
plot(out)
```

**Competition**

``` {r comp-plot-with-phage, echo = FALSE}
parameters_Comp = c(mu_s = 0.0521922,#1.043844*0.05 based on experimental work
                    k_e_lactose = 7e-7,
                    c_e_lactose = 2e-12,
                    c_s_lactose = 2e-12,
                    mu_e = 0.03044743,  #0.6089485*0.05 based on experimental work 
                    k_s_lactose = 7e-7,
                    
                    burst_gen = 5,
                    burst_sp = 5,
                    burst_sp2 = 5,
                    adsorp_gen = 1e-8,
                    adsorp_sp = 1e-8,
                    adsorp_sp2 = 1e-8
)

Comp <- function(t,n,parms){
  with(as.list(c(t,n,parms)), {
    if (Es < 1e-20){
      Es = 0
    }
    if (Er < 1e-20){
      Er = 0
    }
    if (Ss < 1e-20){
      Ss = 0
    }
    if (Sr < 1e-20){
      Sr = 0
    }
    if (lcts < 1e-50){
      lcts = 0
    }
    
    gEs = Es * mu_e * (lcts / (lcts + k_e_lactose)) 
    dEs = gEs - (Es*gen*adsorp_gen) - (Es*sp2*adsorp_sp2) 
    dEdead = (Es*gen*adsorp_gen) + (Es*sp2*adsorp_sp2) 
    dEr = Er * mu_e * (lcts / (lcts + k_e_lactose))
    
    gSs = Ss * mu_s * (lcts / (lcts + k_s_lactose))
    dSs = gSs - (Ss*sp*adsorp_sp) - (Ss*gen*adsorp_gen)
    dSdead = (Ss*sp*adsorp_sp) + (Ss*gen*adsorp_gen)
    dSr = Sr * mu_s * (lcts / (lcts + k_s_lactose))
    
    dlcts = (-(gEs+dEr) * c_e_lactose) - ((gSs+dSr) * c_s_lactose)
    
    dgen = (gen * burst_gen * Es * adsorp_gen) + (gen * burst_gen * Ss * adsorp_gen)
    dsp = (sp * burst_sp * Ss * adsorp_sp)
    dsp2 = (sp2 * burst_sp2 * Es * adsorp_sp2)
    
    return(list(c(dEs, dEr, dSs, dSr, dgen, dsp, dsp2, dEdead, dSdead, dlcts)))
  })
}
time = seq(from = 0 , to = 1e5, by = 10)
start_density = c(Es = 1e4, Er = 0, Ss = 1e4, Sr = 0, gen = 1, sp = 1, sp2 = 0, Edead = 0, Sdead = 0, lcts = 1e-3)
out=ode(y=start_density,
          times=time,
          func=Comp,
          parms = parameters_Comp,
          rtol = 1e-14)
#COMPETITION
plot(out)
```

**Neutral**

``` {r neutral-plot-with-phage, echo=FALSE}
parameters_Neutral = c(mu_e = 0.40175,#0.8035*0.5, e rate of growth in lcts+met media
                       k_e_lactose = 7e-7,
                       c_e_lactose = 2e-12,
                       c_s_acetate = 2e-12,#formerly 3e-13
                       mu_s = 0.5359195, #1.071839*0.5, s rate of growth in gluc media
                       k_s_acetate = 7e-7, #formerly 3e-7
                       
                       burst_gen = 5,
                       burst_sp = 5,
                       burst_sp2 = 5,
                       adsorp_gen = 1e-8,
                       adsorp_sp = 1e-8,
                       adsorp_sp2 = 1e-8
)

Neutral <- function(t,n,parms){
  with(as.list(c(t,n,parms)), {
    
    if (Es < 1e-20){
      Es = 0
    }
    if (Er < 1e-20){
      Er = 0
    }
    if (Ss < 1e-20){
      Ss = 0
    }
    if (Sr < 1e-20){
      Sr = 0
    }
    if (lcts < 1e-50){
      lcts = 0
    }
    if (ac < 1e-50){
      ac = 0
    }
    
    gEs = Es * mu_e * (lcts / (lcts + k_e_lactose)) 
    dEs = gEs - (Es*gen*adsorp_gen) - (Es*sp2*adsorp_sp2)
    dEdead = (Es*gen*adsorp_gen) + (Es*sp2*adsorp_sp2)
    dEr = Er * mu_e * (lcts / (lcts + k_e_lactose))
    
    gSs = Ss * mu_s * (ac / (ac + k_s_acetate))
    dSs = gSs - (Ss*sp*adsorp_sp) - (Ss*gen*adsorp_gen)
    dSdead = (Ss*sp*adsorp_sp) + (Ss*gen*adsorp_gen)
    dSr = Sr * mu_s * (ac / (ac + k_s_acetate))
    
    dlcts = (-(gEs+dEr) * c_e_lactose)
    dac = (-(gSs+dSr) * c_s_acetate)
    
    dgen = (gen * burst_gen * Es * adsorp_gen) + (gen * burst_gen * Ss * adsorp_gen)
    dsp = (sp * burst_sp * Ss * adsorp_sp)
    dsp2 = (sp2 * burst_sp2 * Es * adsorp_sp2)
    
    return(list(c(dEs, dEr, dSs, dSr, dgen, dsp, dsp2, dEdead, dSdead, dlcts, dac)))
  })
}
time = seq(from = 0 , to = 1e5, by = 10)
start_density = c(Es = 1e4, Er = 0, Ss = 1e4, Sr = 0, gen = 1, sp = 1, sp2 = 0, Edead = 0, Sdead = 0, lcts = 1e-3, ac = 1e-3)
out=ode(y=start_density,
          times=time,
          func=Neutral,
          parms = parameters_Neutral,
          rtol = 1e-14)
plot(out)
```

In all three cases, both bacterial species are driven to extinction and the generalist dominates at equilibrium. 

### Adjusting Burst Size

To impose a cost of generalism, one of the main parameters that is changed is burst size. In standard simulation runs, specialist burst size is racheted up from 0x to 10x of the generalist's burst size. The following plot shows the density of each phage type at equilibrium (final time point), as specialist burst size increases. The y-axis represents phage density of the specialist and generalist while the x-axis represents the fold-increase in infectivity (i.e. 5 = specialist's burst size is 5x the burst size of the generalist). The plot is faceted by interaction condition.

```{r burst-size, echo = FALSE}
#coop
parameters_Coop = c(mu_e = 0.5,
                    k_e_lactose = 7e-7,#speed of eating
                    k_e_met = 3e-7,#formerly 3e-7
                    c_e_lactose = 2e-12,#amount used to make one cell
                    p_e_acetate = 1e-13,#amount produced by one cell
                    c_s_acetate = 3e-13,#formerly 3e-13
                    p_s_met = 10e-14, #formerly 10e-14
                    c_e_met = 2e-14,#formerly 2e-14
                    mu_s = 0.2,   
                    k_s_acetate = 3e-7, #formerly 3e-7
                    
                    burst_gen = 5,
                    burst_sp = 5,
                    burst_sp2 = 5,
                    adsorp_gen = 1e-8,
                    adsorp_sp = 1e-8,
                    adsorp_sp2 = 1e-8
)

Coop <- function(t,n,parms){
  with(as.list(c(t,n,parms)), {
    
    if (Es < 1e-20){
      Es = 0
    }
    if (Er < 1e-20){
      Er = 0
    }
    if (Ss < 1e-20){
      Ss = 0
    }
    if (Sr < 1e-20){
      Sr = 0
    }
    if (lcts < 1e-50){
      lcts = 0
    }
    if (ac < 1e-50){
      ac = 0
    }
    if (met < 1e-50){
      met = 0
    }
    
    gEs = Es * mu_e * (lcts / (lcts + k_e_lactose)) * (met / (met + k_e_met))
    dEs = gEs - (Es*gen*adsorp_gen) - (Es*sp2*adsorp_sp2)
    dEdead = (Es*gen*adsorp_gen) + (Es*sp2*adsorp_sp2) 
    dEr = Er * mu_e * (lcts / (lcts + k_e_lactose)) * (met / (met + k_e_met)) 
    
    gSs = Ss * mu_s * (ac / (ac + k_s_acetate))
    dSs = gSs - (Ss*sp*adsorp_sp) - (Ss*gen*adsorp_gen) 
    dSdead = (Ss*sp*adsorp_sp) + (Ss*gen*adsorp_gen) 
    dSr = Sr * mu_s * (ac / (ac + k_s_acetate)) 
    
    dlcts =  (-(gEs+dEr) * c_e_lactose) 
    dmet = (-(gEs+dEr) * c_e_met)  + ((gSs+dSr) * p_s_met) 
    dac = (-(gSs+dSr) * c_s_acetate) + ((gEs+dEr) * p_e_acetate)
    
    dgen = (gen * burst_gen * Es * adsorp_gen) + (gen * burst_gen * Ss * adsorp_gen) 
    dsp = (sp * burst_sp * Ss * adsorp_sp) 
    dsp2 = (sp2 * burst_sp2 * Es * adsorp_sp2)
    
    return(list(c(dEs, dEr, dSs, dSr, dgen, dsp, dsp2, dEdead, dSdead, dlcts, dmet, dac)))
  })
}
#comp
parameters_Comp = c(mu_s = 0.0521922,#1.043844*0.05 based on experimental work
                    k_e_lactose = 7e-7,
                    c_e_lactose = 2e-12,
                    c_s_lactose = 2e-12,
                    mu_e = 0.03044743,  #0.6089485*0.05 based on experimental work 
                    k_s_lactose = 7e-7,
                    
                    burst_gen = 5,
                    burst_sp = 5,
                    burst_sp2 = 5,
                    adsorp_gen = 1e-8,
                    adsorp_sp = 1e-8,
                    adsorp_sp2 = 1e-8
)

Comp <- function(t,n,parms){
  with(as.list(c(t,n,parms)), {
    if (Es < 1e-20){
      Es = 0
    }
    if (Er < 1e-20){
      Er = 0
    }
    if (Ss < 1e-20){
      Ss = 0
    }
    if (Sr < 1e-20){
      Sr = 0
    }
    if (lcts < 1e-50){
      lcts = 0
    }
    
    gEs = Es * mu_e * (lcts / (lcts + k_e_lactose)) 
    dEs = gEs - (Es*gen*adsorp_gen) - (Es*sp2*adsorp_sp2) 
    dEdead = (Es*gen*adsorp_gen) + (Es*sp2*adsorp_sp2) 
    dEr = Er * mu_e * (lcts / (lcts + k_e_lactose))
    
    gSs = Ss * mu_s * (lcts / (lcts + k_s_lactose))
    dSs = gSs - (Ss*sp*adsorp_sp) - (Ss*gen*adsorp_gen)
    dSdead = (Ss*sp*adsorp_sp) + (Ss*gen*adsorp_gen)
    dSr = Sr * mu_s * (lcts / (lcts + k_s_lactose))
    
    dlcts = (-(gEs+dEr) * c_e_lactose) - ((gSs+dSr) * c_s_lactose)
    
    dgen = (gen * burst_gen * Es * adsorp_gen) + (gen * burst_gen * Ss * adsorp_gen)
    dsp = (sp * burst_sp * Ss * adsorp_sp)
    dsp2 = (sp2 * burst_sp2 * Es * adsorp_sp2)
    
    return(list(c(dEs, dEr, dSs, dSr, dgen, dsp, dsp2, dEdead, dSdead, dlcts)))
  })
}
#neutral
parameters_Neutral = c(mu_e = 0.40175,#0.8035*0.5, e rate of growth in lcts+met media
                       k_e_lactose = 7e-7,
                       c_e_lactose = 2e-12,
                       c_s_acetate = 2e-12,#formerly 3e-13
                       mu_s = 0.5359195, #1.071839*0.5, s rate of growth in gluc media
                       k_s_acetate = 7e-7, #formerly 3e-7
                       
                       burst_gen = 5,
                       burst_sp = 5,
                       burst_sp2 = 5,
                       adsorp_gen = 1e-8,
                       adsorp_sp = 1e-8,
                       adsorp_sp2 = 1e-8
)

Neutral <- function(t,n,parms){
  with(as.list(c(t,n,parms)), {
    
    if (Es < 1e-20){
      Es = 0
    }
    if (Er < 1e-20){
      Er = 0
    }
    if (Ss < 1e-20){
      Ss = 0
    }
    if (Sr < 1e-20){
      Sr = 0
    }
    if (lcts < 1e-50){
      lcts = 0
    }
    if (ac < 1e-50){
      ac = 0
    }
    
    gEs = Es * mu_e * (lcts / (lcts + k_e_lactose)) 
    dEs = gEs - (Es*gen*adsorp_gen) - (Es*sp2*adsorp_sp2)
    dEdead = (Es*gen*adsorp_gen) + (Es*sp2*adsorp_sp2)
    dEr = Er * mu_e * (lcts / (lcts + k_e_lactose))
    
    gSs = Ss * mu_s * (ac / (ac + k_s_acetate))
    dSs = gSs - (Ss*sp*adsorp_sp) - (Ss*gen*adsorp_gen)
    dSdead = (Ss*sp*adsorp_sp) + (Ss*gen*adsorp_gen)
    dSr = Sr * mu_s * (ac / (ac + k_s_acetate))
    
    dlcts = (-(gEs+dEr) * c_e_lactose)
    dac = (-(gSs+dSr) * c_s_acetate)
    
    dgen = (gen * burst_gen * Es * adsorp_gen) + (gen * burst_gen * Ss * adsorp_gen)
    dsp = (sp * burst_sp * Ss * adsorp_sp)
    dsp2 = (sp2 * burst_sp2 * Es * adsorp_sp2)
    
    return(list(c(dEs, dEr, dSs, dSr, dgen, dsp, dsp2, dEdead, dSdead, dlcts, dac)))
  })
}
#all parms
time = seq(from = 0 , to = 1e5, by = 10)
burst_sp <- c(0:50) #set range of burst size parameters 
adsorp_sp <- 1e-9 * burst_sp
#coop loop
start_density = c(Es = 1e4, Er = 0, Ss = 1e4, Sr = 0, gen = 1, sp = 1, sp2 = 0, Edead = 0, Sdead = 0,
                  lcts = 1e-3, met = 1e-12, ac = 0)
burst_Coop = parameters_Coop
burst_coop = data.frame()
for (i in 1:length(burst_sp)){
  burst_Coop['burst_sp']=burst_sp[i]
  out=ode(y=start_density,
          times=time,
          func=Coop,
          parms = burst_Coop,
          rtol = 1e-14)
  cost_type = burst_sp[i] / 5
  out=data.frame(out) %>%
    mutate(biomass = Es + Er + Ss + Sr) %>%
    mutate(phageratio_sp = gen / (sp+gen)) %>%
    mutate(phageratio_sp2 = gen / (sp2+gen)) %>%
    mutate(cost = cost_type)
  burst_coop = rbind(burst_coop, out)
}
#comp loop
start_density = c(Es = 1e4, Er = 0, Ss = 1e4, Sr = 0, gen = 1, sp = 1, sp2 = 0, Edead = 0, Sdead = 0,
                  lcts = 1e-3) 
burst_Comp = parameters_Comp
burst_comp = data.frame()
for (i in 1:length(burst_sp)){
  burst_Comp['burst_sp']=burst_sp[i]
  out=ode(y=start_density,
          times=time,
          func=Comp,
          parms = burst_Comp,
          rtol = 1e-14)
  cost_type = burst_sp[i] / 5
  out=data.frame(out) %>%
    mutate(biomass = Es + Er + Ss + Sr) %>%
    mutate(phageratio_sp = gen / (sp+gen)) %>%
    mutate(phageratio_sp2 = gen / (sp2+gen)) %>%
    mutate(cost = cost_type)
  burst_comp = rbind(burst_comp, out)
}
#neutral loop
start_density = c(Es = 0, Er = 0, Ss = 1e4, Sr = 0, gen = 1, sp = 1, sp2 = 0, Edead = 0, Sdead = 0,
                  lcts = 1e-3, ac = 1e-3)
burst_Neutral = parameters_Neutral
burst_neutral = data.frame()
for (i in 1:length(burst_sp)){
  burst_Neutral['burst_sp']=burst_sp[i]
  out=ode(y=start_density,
          times=time,
          func=Neutral,
          parms = burst_Neutral,
          rtol = 1e-14)
  cost_type = burst_sp[i] / 5
  out=data.frame(out) %>%
    mutate(biomass = Es + Er + Ss + Sr) %>%
    mutate(phageratio_sp = gen / (sp+gen)) %>%
    mutate(phageratio_sp2 = gen / (sp2+gen)) %>%
    mutate(cost = cost_type)
  burst_neutral  = rbind(burst_neutral, out)
}
#plots
max_coop_cost <- burst_coop[burst_coop$time == max(burst_coop$time),]
max_comp_cost <- burst_comp[burst_comp$time == max(burst_comp$time),]
max_neutral_cost <- burst_neutral[burst_neutral$time == max(burst_neutral$time),]
max_coop_cost <- max_coop_cost[,c(6,7,17)]
max_comp_cost <- max_comp_cost[,c(6,7,15)]
max_neutral_cost <- max_neutral_cost[,c(6,7,16)]
max_comp_cost$label <- "comp"
max_coop_cost$label <- "coop"
max_neutral_cost$label <- "neutral"
max <- rbind(max_coop_cost, max_comp_cost, max_neutral_cost)
melted <- melt(max, id = c("label", "cost"))
plot <- melted %>%
  ggplot(aes(x=cost, y = log10(value), color = variable))+
  geom_line(size = 2)+
  facet_wrap(~label)+
  theme_bw()+
  ylab("Equilibrium Phage Density (Log10)")+
  xlab("Fold-Increase in Specialist Infectivity")+
  theme(axis.title.y = element_text(face = "bold"))+
  theme(axis.title.x = element_text(face = "bold"))+
  theme(legend.title = element_text(face = "bold"))
plot
```

When using burst size as the cost of generalism, there appears to be an asymptotic effect on competing hosts: because of the density limitations of the system, increasing burst size will only increase equilibrium specialist phage density up to a certain point, after which it levels off. The same is not true of the cooperative system, likely because the slower growth means bacterial density is not approaching the carrying capacity imposed by lactose limitation. 

### Adjusting Attachment Rate

The other parameter used to impose a cost of generalism is attachment rate. As before, in standard simulation runs, specialist attachment rate is racheted up from 0x to 10x of the generalist's attachment rate. The following plot depicts equilibrium phage density versus fold increase in specialist infectivity as previously described, with attachment rate serving as infectivity. 

```{r attachment-rate, echo = FALSE}
#coop
parameters_Coop = c(mu_e = 0.5,
                    k_e_lactose = 7e-7,#speed of eating
                    k_e_met = 3e-7,#formerly 3e-7
                    c_e_lactose = 2e-12,#amount used to make one cell
                    p_e_acetate = 1e-13,#amount produced by one cell
                    c_s_acetate = 3e-13,#formerly 3e-13
                    p_s_met = 10e-14, #formerly 10e-14
                    c_e_met = 2e-14,#formerly 2e-14
                    mu_s = 0.2,   
                    k_s_acetate = 3e-7, #formerly 3e-7
                    
                    burst_gen = 5,
                    burst_sp = 5,
                    burst_sp2 = 5,
                    adsorp_gen = 1e-8,
                    adsorp_sp = 1e-8,
                    adsorp_sp2 = 1e-8
)

Coop <- function(t,n,parms){
  with(as.list(c(t,n,parms)), {
    
    if (Es < 1e-20){
      Es = 0
    }
    if (Er < 1e-20){
      Er = 0
    }
    if (Ss < 1e-20){
      Ss = 0
    }
    if (Sr < 1e-20){
      Sr = 0
    }
    if (lcts < 1e-50){
      lcts = 0
    }
    if (ac < 1e-50){
      ac = 0
    }
    if (met < 1e-50){
      met = 0
    }
    
    gEs = Es * mu_e * (lcts / (lcts + k_e_lactose)) * (met / (met + k_e_met))
    dEs = gEs - (Es*gen*adsorp_gen) - (Es*sp2*adsorp_sp2)
    dEdead = (Es*gen*adsorp_gen) + (Es*sp2*adsorp_sp2) 
    dEr = Er * mu_e * (lcts / (lcts + k_e_lactose)) * (met / (met + k_e_met)) 
    
    gSs = Ss * mu_s * (ac / (ac + k_s_acetate))
    dSs = gSs - (Ss*sp*adsorp_sp) - (Ss*gen*adsorp_gen) 
    dSdead = (Ss*sp*adsorp_sp) + (Ss*gen*adsorp_gen) 
    dSr = Sr * mu_s * (ac / (ac + k_s_acetate)) 
    
    dlcts =  (-(gEs+dEr) * c_e_lactose) 
    dmet = (-(gEs+dEr) * c_e_met)  + ((gSs+dSr) * p_s_met) 
    dac = (-(gSs+dSr) * c_s_acetate) + ((gEs+dEr) * p_e_acetate)
    
    dgen = (gen * burst_gen * Es * adsorp_gen) + (gen * burst_gen * Ss * adsorp_gen) 
    dsp = (sp * burst_sp * Ss * adsorp_sp) 
    dsp2 = (sp2 * burst_sp2 * Es * adsorp_sp2)
    
    return(list(c(dEs, dEr, dSs, dSr, dgen, dsp, dsp2, dEdead, dSdead, dlcts, dmet, dac)))
  })
}
#comp
parameters_Comp = c(mu_s = 0.0521922,#1.043844*0.05 based on experimental work
                    k_e_lactose = 7e-7,
                    c_e_lactose = 2e-12,
                    c_s_lactose = 2e-12,
                    mu_e = 0.03044743,  #0.6089485*0.05 based on experimental work 
                    k_s_lactose = 7e-7,
                    
                    burst_gen = 5,
                    burst_sp = 5,
                    burst_sp2 = 5,
                    adsorp_gen = 1e-8,
                    adsorp_sp = 1e-8,
                    adsorp_sp2 = 1e-8
)

Comp <- function(t,n,parms){
  with(as.list(c(t,n,parms)), {
    if (Es < 1e-20){
      Es = 0
    }
    if (Er < 1e-20){
      Er = 0
    }
    if (Ss < 1e-20){
      Ss = 0
    }
    if (Sr < 1e-20){
      Sr = 0
    }
    if (lcts < 1e-50){
      lcts = 0
    }
    
    gEs = Es * mu_e * (lcts / (lcts + k_e_lactose)) 
    dEs = gEs - (Es*gen*adsorp_gen) - (Es*sp2*adsorp_sp2) 
    dEdead = (Es*gen*adsorp_gen) + (Es*sp2*adsorp_sp2) 
    dEr = Er * mu_e * (lcts / (lcts + k_e_lactose))
    
    gSs = Ss * mu_s * (lcts / (lcts + k_s_lactose))
    dSs = gSs - (Ss*sp*adsorp_sp) - (Ss*gen*adsorp_gen)
    dSdead = (Ss*sp*adsorp_sp) + (Ss*gen*adsorp_gen)
    dSr = Sr * mu_s * (lcts / (lcts + k_s_lactose))
    
    dlcts = (-(gEs+dEr) * c_e_lactose) - ((gSs+dSr) * c_s_lactose)
    
    dgen = (gen * burst_gen * Es * adsorp_gen) + (gen * burst_gen * Ss * adsorp_gen)
    dsp = (sp * burst_sp * Ss * adsorp_sp)
    dsp2 = (sp2 * burst_sp2 * Es * adsorp_sp2)
    
    return(list(c(dEs, dEr, dSs, dSr, dgen, dsp, dsp2, dEdead, dSdead, dlcts)))
  })
}
#neutral
parameters_Neutral = c(mu_e = 0.40175,#0.8035*0.5, e rate of growth in lcts+met media
                       k_e_lactose = 7e-7,
                       c_e_lactose = 2e-12,
                       c_s_acetate = 2e-12,#formerly 3e-13
                       mu_s = 0.5359195, #1.071839*0.5, s rate of growth in gluc media
                       k_s_acetate = 7e-7, #formerly 3e-7
                       
                       burst_gen = 5,
                       burst_sp = 5,
                       burst_sp2 = 5,
                       adsorp_gen = 1e-8,
                       adsorp_sp = 1e-8,
                       adsorp_sp2 = 1e-8
)

Neutral <- function(t,n,parms){
  with(as.list(c(t,n,parms)), {
    
    if (Es < 1e-20){
      Es = 0
    }
    if (Er < 1e-20){
      Er = 0
    }
    if (Ss < 1e-20){
      Ss = 0
    }
    if (Sr < 1e-20){
      Sr = 0
    }
    if (lcts < 1e-50){
      lcts = 0
    }
    if (ac < 1e-50){
      ac = 0
    }
    
    gEs = Es * mu_e * (lcts / (lcts + k_e_lactose)) 
    dEs = gEs - (Es*gen*adsorp_gen) - (Es*sp2*adsorp_sp2)
    dEdead = (Es*gen*adsorp_gen) + (Es*sp2*adsorp_sp2)
    dEr = Er * mu_e * (lcts / (lcts + k_e_lactose))
    
    gSs = Ss * mu_s * (ac / (ac + k_s_acetate))
    dSs = gSs - (Ss*sp*adsorp_sp) - (Ss*gen*adsorp_gen)
    dSdead = (Ss*sp*adsorp_sp) + (Ss*gen*adsorp_gen)
    dSr = Sr * mu_s * (ac / (ac + k_s_acetate))
    
    dlcts = (-(gEs+dEr) * c_e_lactose)
    dac = (-(gSs+dSr) * c_s_acetate)
    
    dgen = (gen * burst_gen * Es * adsorp_gen) + (gen * burst_gen * Ss * adsorp_gen)
    dsp = (sp * burst_sp * Ss * adsorp_sp)
    dsp2 = (sp2 * burst_sp2 * Es * adsorp_sp2)
    
    return(list(c(dEs, dEr, dSs, dSr, dgen, dsp, dsp2, dEdead, dSdead, dlcts, dac)))
  })
}
#all parms
time = seq(from = 0 , to = 1e5, by = 10)
burst_sp <- c(0:100) #set range of burst size parameters 
adsorp_sp <- 1e-9 * burst_sp
#coop loop
adsorp_Coop = parameters_Coop #rename parameters or can't reuse after loop
start_density = c(Es = 1e4, Er = 0, Ss = 1e4, Sr = 0, gen = 1, sp = 1, sp2 = 0, Edead = 0, Sdead = 0,
                  lcts = 1e-3, met = 1e-12, ac = 0) 
adsorp_coop = data.frame()
for (i in 1:length(adsorp_sp)){
  adsorp_Coop['adsorp_sp']=adsorp_sp[i]
  out=ode(y=start_density,
          times=time,
          func=Coop,
          parms = adsorp_Coop,
          rtol = 1e-14)
  cost_type = adsorp_sp[i] / 1e-8
  out=data.frame(out) %>%
    mutate(biomass = Es + Er + Ss + Sr) %>%
    mutate(phageratio_sp = gen / (sp+gen)) %>%
    mutate(phageratio_sp2 = gen / (sp2+gen)) %>%
    mutate(cost = cost_type)
  adsorp_coop = rbind(adsorp_coop, out)
}
#comp loop
adsorp_Comp = parameters_Comp
start_density = c(Es = 1e4, Er = 0, Ss = 1e4, Sr = 0, gen = 1, sp = 1, sp2 = 0, Edead = 0, Sdead = 0,
                  lcts = 1e-3) 
adsorp_comp = data.frame()
for (i in 1:length(adsorp_sp)){
  adsorp_Comp['adsorp_sp']=adsorp_sp[i]
  out=ode(y=start_density,
          times=time,
          func=Comp,
          parms = adsorp_Comp,
          rtol = 1e-14)
  cost_type = adsorp_sp[i] / 1e-8
  out=data.frame(out) %>%
    mutate(biomass = Es + Er + Ss + Sr) %>%
    mutate(phageratio_sp = gen / (sp+gen)) %>%
    mutate(phageratio_sp2 = gen / (sp2+gen)) %>%
    mutate(cost = cost_type)
  adsorp_comp = rbind(adsorp_comp, out)
}
#neutral loop
adsorp_Neutral = parameters_Neutral
start_density = c(Es = 0, Er = 0, Ss = 1e4, Sr = 0, gen = 1, sp = 1, sp2 = 0, Edead = 0, Sdead = 0,
                  lcts = 1e-3, ac = 1e-3)
adsorp_neutral = data.frame()
for (i in 1:length(adsorp_sp)){
  adsorp_Neutral['adsorp_sp']=adsorp_sp[i]
  out=ode(y=start_density,
          times=time,
          func=Neutral,
          parms = adsorp_Neutral,
          rtol = 1e-14)
  cost_type = adsorp_sp[i] / 1e-8
  out=data.frame(out) %>%
    mutate(biomass = Es + Er + Ss + Sr) %>%
    mutate(phageratio_sp = gen / (sp+gen)) %>%
    mutate(phageratio_sp2 = gen / (sp2+gen)) %>%
    mutate(cost = cost_type)
  adsorp_neutral = rbind(adsorp_neutral, out)
}
#plots
max_coop_cost <- adsorp_coop[adsorp_coop$time == max(adsorp_coop$time),]
max_comp_cost <- adsorp_comp[adsorp_comp$time == max(adsorp_comp$time),]
max_neutral_cost <- adsorp_neutral[adsorp_neutral$time == max(adsorp_neutral$time),]
max_coop_cost <- max_coop_cost[,c(6,7,17)]
max_comp_cost <- max_comp_cost[,c(6,7,15)]
max_neutral_cost <- max_neutral_cost[,c(6,7,16)]
max_comp_cost$label <- "comp"
max_coop_cost$label <- "coop"
max_neutral_cost$label <- "neutral"
max <- rbind(max_coop_cost, max_comp_cost, max_neutral_cost)
melted <- melt(max, id = c("label", "cost"))
plot <- melted %>%
  ggplot(aes(x=cost, y = log10(value), color = variable))+
  geom_line(size = 2)+
  facet_wrap(~label)+
  theme_bw()+
  ylab("Equilibrium Phage Density (Log10)")+
  xlab("Fold-Increase in Specialist Infectivity")+
  theme(axis.title.y = element_text(face = "bold"))+
  theme(axis.title.x = element_text(face = "bold"))+
  theme(legend.title = element_text(face = "bold"))
plot
```

Here, it is evident that adjusting the attachment rate generally favors the generalist in cases where the bacterial species are interacting. When species are competing, there is small a range of attachment rates between 1.1x and 2.75x where the specialist is favored, but there are diminishing returns for being a better and better specialist (likely because the specialist is tearing through its host population too quickly). When species are cooperating, increasing attachment rate causes the ratio of generalists and specialists to converge at roughly 50:50. The specialist doesn't gain a significant advantage at any point, even as its attachment rate increases. 

## The phenomenological LV model equations

Below are the LV model equations, contained as functions for use by deSolve's ode. The equation parameters can be tweaked to represent cooperating or competing hosts. The system does not include equations for the resources, as the equations as resource-implicit, but does track E coli, S enterica, a generalist phage, and a specialist phage attacking S enterica over time. The model can easily be modified to include a phage that specializes on E coli.

``` {r LV-model-equations}

generalLV <- function(t,n,parms){
  with(as.list(c(t,n,parms)), {
    
    dE = rate_e * E * ((alpha1*S)/((alpha1*S) + k_e)) * (1-E-(beta1*S)) - c2*gen*E - dilution*E
    dS = rate_s * S * ((alpha2*E)/((alpha2*E) + k_s)) * (1-S-(beta2*E)) - c1*sp*S - c2*gen*S - dilution*S
    dgen = gamma1*gen*S + gamma2*gen*E - dilution*gen
    dsp = gamma3*sp*S - dilution*sp
  
    return(list(c(dE, dS, dgen, dsp)))
  })
}
```

### LV standard constants

Standard constants for competitive growth rates were derived from experimental work by ATB (growth rate of E coli and S enterica in glucose+methionine media). Mutualism and competition coefficients are abitrary, chosen to result in the same final equilibrium ratio of E:S as in resource-explicit models (without phage). Importantly, when modeling mutualism, beta values should be set to one and the half-saturation constant must be greater than zero. When modeling competition, alpha values should be set to one and the half-saturation constant must equal 0. Rate of dilution and mutualism half-saturation constants were chosen arbitrarily to ensure that an equilibrium is reached during simulations. Phage productivity and rate of consumption constants are derived from resource-explicit adsorption and burst size values, where rate of consumption is loosely equivalent to adsorption and productivity is burst size multiplied by adsorption. 

``` {r standard-constants-LV}

#COOPERATION SETTINGS
#mutualism coefficients
alpha1 = 5 
alpha2 = 1.1 

#competition coefficients
beta1 = 1
beta2 = 1

#intrinsic growth rate
rate_e = 1.5
rate_s = 1.5

#phage productivity constants
gamma1 = 5e-5
gamma2 = 5e-5
gamma3 = 5e-5

#phage rate of consumption constants
c1 = 5e-6
c2 = 5e-6

#additional constants
dilution = 3e-7 #rate of dilution (emigration/death)
k_e = 10 #half-saturation
k_s = 10 #half-saturation
                    
#COMPETITION SETTINGS
#mutualism coefficients
alpha1 = 1
alpha2 = 1 

#competition coefficients
beta1 = 1.1 
beta2 = 0.9 #lower beta = better competitor

#intrinsic growth rate
rate_e = 0.6089485 #experimentally determined
rate_s = 1.043844 #experimentally determined

#phage productivity constants
gamma1 = 5e-5
gamma2 = 5e-5
gamma3 = 5e-5

#phage rate of consumption constants
c1 = 5e-6
c2 = 5e-6

#additional constants
dilution = 3e-7 #rate of dilution (emigration/death)
k_e = 0 #half-saturation
k_s = 0 #half-saturation
```

### Simulation Set Points

Below is the standard starting density and timeframe for all LV simulations. Because of the normalized resource pool, bacterial and phage species are set to a seed density of less than one to maximize growth. Tweaking the starting conditions does not considerably alter the equilibrial dynamics; more on that later. All simulations were completed with all four species seeded at a starting density of 0.1.

``` {r simulation-set-points-LV}
#time frame for all simulations
time = seq(from = 0 , to = 5e5, by = 10)

#starting density for all initial simulations 
start_density <- c(E = 0.1, S = 0.1, gen = 0.1, sp = 0.1)
```

### LV Basic Dynamics Without Phage

To get a sense of the equilibrial dynamics of the model without phage, plots are included below of each condition. 

**Cooperation**

```{r coop-plot-without-phage-LV, echo = FALSE}
#cooperative plot
parameters = c(alpha1 = 5, 
                    alpha2 = 1.1, 
                    
                    beta1 = 1, 
                    beta2 = 1, 
                    
                    rate_e = 1.5,#intrinsic rate of growth of E
                    rate_s = 1.5, #instrinsic rate of growth of S
                    
                    gamma1 = 5e-5,
                    gamma2 = 5e-5,
                    gamma3 = 5e-5,
                    
                    dilution = 3e-7, #rate of dilution (emigration/death)
                    k_e = 10, 
                    k_s = 10, 
                    
                    c1 = 5e-6, 
                    c2 = 5e-6 
          
)

generalLV <- function(t,n,parms){
  with(as.list(c(t,n,parms)), {
    
    dE = rate_e * E * ((alpha1*S)/((alpha1*S) + k_e)) * (1-E-(beta1*S)) - c2*gen*E - dilution*E
    dS = rate_s * S * ((alpha2*E)/((alpha2*E) + k_s)) * (1-S-(beta2*E)) - c1*sp*S - c2*gen*S - dilution*S
    dgen = gamma1*gen*S + gamma2*gen*E - dilution*gen
    dsp = gamma3*sp*S - dilution*sp
  
    return(list(c(dE, dS, dgen, dsp)))
  })
}

time = seq(from = 0 , to = 5e5, by = 10)
start_density <- c(E = 0.1, S = 0.1, gen = 0, sp = 0)
out <- ode(y = start_density, times = time, 
            func = generalLV, parms = parameters)
plot(out)
```

**Competition**

``` {r comp-plot-without-phage-LV, echo = FALSE}
parameters = c(alpha1 = 1, 
               alpha2 = 1, 
               
               beta1 = 1,
               beta2 = 0.9, 
               
               rate_e = 0.6089485,#intrinsic rate of growth of E
               rate_s = 1.043844, #instrinsic rate of growth of S
               
               gamma1 = 5e-5,
               gamma2 = 5e-5,
               gamma3 = 5e-5,
               
               dilution = 3e-7, #rate of dilution (emigration/death)
               k_e = 0, 
               k_s = 0, 
               
               c1 = 5e-6, 
               c2 = 5e-6 
               
)

generalLV <- function(t,n,parms){
  with(as.list(c(t,n,parms)), {
    
    dE = rate_e * E * ((alpha1*S)/((alpha1*S) + k_e)) * (1-E-(beta1*S)) - c2*gen*E - dilution*E
    dS = rate_s * S * ((alpha2*E)/((alpha2*E) + k_s)) * (1-S-(beta2*E)) - c1*sp*S - c2*gen*S - dilution*S
    dgen = gamma1*gen*S + gamma2*gen*E - dilution*gen
    dsp = gamma3*sp*S - dilution*sp
  
    return(list(c(dE, dS, dgen, dsp)))
  })
}

time = seq(from = 0 , to = 5e5, by = 10)
start_density <- c(E = 0.1, S = 0.1, gen = 0, sp = 0)
out <- ode(y = start_density, times = time, 
            func = generalLV, parms = parameters)
plot(out)
```

As in the resource-explicit model, parameters are set such that, in the absence of phage, cooperating bacterial species converge to a ratio of around 75:25 (E:S) and competing bacterial species converge to a ratio of 1:99 (E:S). 

### LV Basic Dynamics With Phage

Here, simulations have been started with a low density of phage and bacterial species, with all set to 0.1. Changing these densities will shift things in predictable ways that are largely uninteresting for the purposes of these analyses, but are briefly described here.

Whether hosts are cooperating or competing, keeping phage density low extends the time that the bacterial species survive, but in all cases they are eventually driven to extinction. Increasing the starting density of phage doesn't fundamentally change the shape of these curves, just how stretched they are across the x axis. 

Unsurprisngly, increasing starting density of bacteria also doesn't change the shape of the curves until the starting density of E + S > 1. In those cases, there is an initial die-off event because of the normalized resource pool - the total population of bacteria cannot exceed 1. 

**Cooperation**

```{r coop-plot-with-phage-LV, echo = FALSE}
#cooperative plot
parameters_coop = c(alpha1 = 5, 
                    alpha2 = 1.1, 
                    
                    beta1 = 1, 
                    beta2 = 1, 
                    
                    rate_e = 1.5,#intrinsic rate of growth of E
                    rate_s = 1.5, #instrinsic rate of growth of S
                    
                    gamma1 = 5e-5,
                    gamma2 = 5e-5,
                    gamma3 = 5e-5,
                    
                    dilution = 3e-7, #rate of dilution (emigration/death)
                    k_e = 10, 
                    k_s = 10, 
                    
                    c1 = 5e-6, 
                    c2 = 5e-6 
          
)

generalLV <- function(t,n,parms){
  with(as.list(c(t,n,parms)), {
    
    dE = rate_e * E * ((alpha1*S)/((alpha1*S) + k_e)) * (1-E-(beta1*S)) - c2*gen*E - dilution*E
    dS = rate_s * S * ((alpha2*E)/((alpha2*E) + k_s)) * (1-S-(beta2*E)) - c1*sp*S - c2*gen*S - dilution*S
    dgen = gamma1*gen*S + gamma2*gen*E - dilution*gen
    dsp = gamma3*sp*S - dilution*sp
  
    return(list(c(dE, dS, dgen, dsp)))
  })
}

time = seq(from = 0 , to = 5e5, by = 10)
start_density <- c(E = 0.1, S = 0.1, gen = 0.1, sp = 0.1)
out <- ode(y = start_density, times = time, 
            func = generalLV, parms = parameters_coop)
plot(out)
```

**Competition**

``` {r comp-plot-with-phage-LV, echo = FALSE}
parameters_comp = c(alpha1 = 1, 
               alpha2 = 1, 
               
               beta1 = 1,
               beta2 = 0.9, 
               
               rate_e = 0.6089485,#intrinsic rate of growth of E
               rate_s = 1.043844, #instrinsic rate of growth of S
               
               gamma1 = 5e-5,
               gamma2 = 5e-5,
               gamma3 = 5e-5,
               
               dilution = 3e-7, #rate of dilution (emigration/death)
               k_e = 0, 
               k_s = 0, 
               
               c1 = 5e-6, 
               c2 = 5e-6 
               
)

generalLV <- function(t,n,parms){
  with(as.list(c(t,n,parms)), {
    
    dE = rate_e * E * ((alpha1*S)/((alpha1*S) + k_e)) * (1-E-(beta1*S)) - c2*gen*E - dilution*E
    dS = rate_s * S * ((alpha2*E)/((alpha2*E) + k_s)) * (1-S-(beta2*E)) - c1*sp*S - c2*gen*S - dilution*S
    dgen = gamma1*gen*S + gamma2*gen*E - dilution*gen
    dsp = gamma3*sp*S - dilution*sp
  
    return(list(c(dE, dS, dgen, dsp)))
  })
}

time = seq(from = 0 , to = 5e5, by = 10)
start_density <- c(E = 0.1, S = 0.1, gen = 0.1, sp = 0.1)
out <- ode(y = start_density, times = time, 
            func = generalLV, parms = parameters_comp)
plot(out)
```

### Adjusting Productivity

To impose a cost of generalism in the LV model, one of the main parameters that altered is productivity (gamma). As in the resource-explicit model, in standard simulation runs, specialist productivity is racheted up from 0x to 50x of the generalist's productivity. The following plot shows the density of each phage type at equilibrium (final time point), as specialist productivity increases. The y-axis represents phage density of the specialist and generalist while the x-axis represents the fold-increase in infectivity (i.e. 5 = specialist's productivity is 5x the productivity of the generalist). The plot is faceted by interaction condition; neutral interactions aren't modeled in the LV equations.

```{r productivity-LV, echo = FALSE}
#coop
parameters_coop = c(alpha1 = 5, 
                    alpha2 = 1.1, 
                    
                    beta1 = 1, 
                    beta2 = 1, 
                    
                    rate_e = 1.5,#intrinsic rate of growth of E
                    rate_s = 1.5, #instrinsic rate of growth of S
                    
                    gamma1 = 5e-5,
                    gamma2 = 5e-5,
                    gamma3 = 5e-5,
                    
                    dilution = 3e-7, #rate of dilution (emigration/death)
                    k_e = 10, 
                    k_s = 10, 
                    
                    c1 = 5e-6, 
                    c2 = 5e-6 
          
)

#comp
parameters_comp = c(alpha1 = 1, 
               alpha2 = 1, 
               
               beta1 = 1,
               beta2 = 0.9, 
               
               rate_e = 0.6089485,#intrinsic rate of growth of E
               rate_s = 1.043844, #instrinsic rate of growth of S
               
               gamma1 = 5e-5,
               gamma2 = 5e-5,
               gamma3 = 5e-5,
               
               dilution = 3e-7, #rate of dilution (emigration/death)
               k_e = 0, 
               k_s = 0, 
               
               c1 = 5e-6, 
               c2 = 5e-6 
               
)

#model
generalLV <- function(t,n,parms){
  with(as.list(c(t,n,parms)), {
    
    dE = rate_e * E * ((alpha1*S)/((alpha1*S) + k_e)) * (1-E-(beta1*S)) - c2*gen*E - dilution*E
    dS = rate_s * S * ((alpha2*E)/((alpha2*E) + k_s)) * (1-S-(beta2*E)) - c1*sp*S - c2*gen*S - dilution*S
    dgen = gamma1*gen*S + gamma2*gen*E - dilution*gen
    dsp = gamma3*sp*S - dilution*sp
  
    return(list(c(dE, dS, dgen, dsp)))
  })
}

#all parms
parm_range <- seq(from = 0.0001 , to = 15, by = 0.1)
time = seq(from = 0 , to = 5e5, by = 10)

#coop loop
gamma3 <- 5e-5 * parm_range
gamma3_Coop = parameters_coop
start_density <- c(E = 0.1, S = 0.1, gen = 0.1, sp = 0.1)
gamma_coop = data.frame()
for (i in 1:length(gamma3)){
  gamma3_Coop['gamma3']=gamma3[i]
  out=ode(y=start_density,
          times=time,
          func=generalLV,
          parms = gamma3_Coop,
          rtol = 1e-14)
  cost_type = gamma3[i] / 5e-5
  out=data.frame(out) %>%
    mutate(biomass = E + S) %>%
    mutate(ratio = gen / (sp+gen)) %>%
    mutate(cost = cost_type)
  gamma_coop = rbind(gamma_coop, out)
}
#comp loop
gamma3 <- 5e-5 * parm_range
gamma3_Comp = parameters_comp
start_density <- c(E = 0.1, S = 0.1, gen = 0.1, sp = 0.1)
gamma_comp = data.frame()
for (i in 1:length(gamma3)){
  gamma3_Comp['gamma3']=gamma3[i]
  out=ode(y=start_density,
          times=time,
          func=generalLV,
          parms = gamma3_Comp,
          rtol = 1e-14)
  cost_type = gamma3[i] / 5e-5
  out=data.frame(out) %>%
    mutate(biomass = E + S) %>%
    mutate(ratio = gen / (sp+gen)) %>%
    mutate(cost = cost_type)
  gamma_comp = rbind(gamma_comp, out)
}

#plots
max_coop_cost <- gamma_coop[gamma_coop$time == max(gamma_coop$time),]
max_comp_cost <- gamma_comp[gamma_comp$time == max(gamma_comp$time),]
max_coop_cost <- max_coop_cost[,c(4,5,8)]
max_comp_cost <- max_comp_cost[,c(4,5,8)]
max_comp_cost$label <- "comp"
max_coop_cost$label <- "coop"
max <- rbind(max_coop_cost, max_comp_cost)
melted <- melt(max, id = c("label", "cost"))
plot <- melted %>%
  ggplot(aes(x=cost, y = log10(value), color = variable))+
  geom_line(size = 2)+
  facet_wrap(~label)+
  theme_bw()+
  ylab("Equilibrium Phage Density (Log10)")+
  xlab("Fold-Increase in Specialist Infectivity")+
  theme(axis.title.y = element_text(face = "bold"))+
  theme(axis.title.x = element_text(face = "bold"))+
  theme(legend.title = element_text(face = "bold"))
plot
```

Interaction type clearly makes a difference here: the advantage gained by an increase in specialist productivity is asymptotic on competing species, and not on cooperating species. This is analogous to the case of burst size in the resource-explicit case, although the infectivity advantage required to select for specialists on cooperating hosts is much higher in this LV model.

### Adjusting Rate of Consumption

The other parameter used to impose a cost of generalism is rate of consumption (c). As before, in standard simulation runs, specialist rate of consumption is racheted up from 0x to 50x of the generalist's rate of consumption. The following plot depicts equilibrium phage density versus fold increase in specialist infectivity as previously described, with rate of consumption serving as infectivity. 

```{r consumption-rate-LV, echo = FALSE}
#coop
parameters_coop = c(alpha1 = 5, 
                    alpha2 = 1.1, 
                    
                    beta1 = 1, 
                    beta2 = 1, 
                    
                    rate_e = 1.5,#intrinsic rate of growth of E
                    rate_s = 1.5, #instrinsic rate of growth of S
                    
                    gamma1 = 5e-5,
                    gamma2 = 5e-5,
                    gamma3 = 5e-5,
                    
                    dilution = 3e-7, #rate of dilution (emigration/death)
                    k_e = 10, 
                    k_s = 10, 
                    
                    c1 = 5e-6, 
                    c2 = 5e-6 
          
)

#comp
parameters_comp = c(alpha1 = 1, 
               alpha2 = 1, 
               
               beta1 = 1,
               beta2 = 0.9, 
               
               rate_e = 0.6089485,#intrinsic rate of growth of E
               rate_s = 1.043844, #instrinsic rate of growth of S
               
               gamma1 = 5e-5,
               gamma2 = 5e-5,
               gamma3 = 5e-5,
               
               dilution = 3e-7, #rate of dilution (emigration/death)
               k_e = 0, 
               k_s = 0, 
               
               c1 = 5e-6, 
               c2 = 5e-6 
               
)

#model
generalLV <- function(t,n,parms){
  with(as.list(c(t,n,parms)), {
    
    dE = rate_e * E * ((alpha1*S)/((alpha1*S) + k_e)) * (1-E-(beta1*S)) - c2*gen*E - dilution*E
    dS = rate_s * S * ((alpha2*E)/((alpha2*E) + k_s)) * (1-S-(beta2*E)) - c1*sp*S - c2*gen*S - dilution*S
    dgen = gamma1*gen*S + gamma2*gen*E - dilution*gen
    dsp = gamma3*sp*S - dilution*sp
  
    return(list(c(dE, dS, dgen, dsp)))
  })
}

#all parms
parm_range <- seq(from = 0.0001 , to = 15, by = 0.1)
time = seq(from = 0 , to = 5e5, by = 10)

#coop loop
c1 <- 5e-6 * parm_range
c1_Coop = parameters_coop
c1_coop = data.frame()
for (i in 1:length(c1)){
  c1_Coop['c1']=c1[i]
  out=ode(y=start_density,
          times=time,
          func=generalLV,
          parms = c1_Coop,
          rtol = 1e-14)
  cost_type = c1[i] / 5e-6
  out=data.frame(out) %>%
    mutate(biomass = E + S) %>%
    mutate(ratio = gen / (sp+gen)) %>%
    mutate(cost = cost_type)
  c1_coop = rbind(c1_coop, out)
}
#comp loop
c1 <- 5e-6 * parm_range
c1_Comp = parameters_comp
c1_comp = data.frame()
for (i in 1:length(c1)){
  c1_Comp['c1']=c1[i]
  out=ode(y=start_density,
          times=time,
          func=generalLV,
          parms = c1_Comp,
          rtol = 1e-14)
  cost_type = c1[i] / 5e-6
  out=data.frame(out) %>%
    mutate(biomass = E + S) %>%
    mutate(ratio = gen / (sp+gen)) %>%
    mutate(cost = cost_type)
  c1_comp = rbind(c1_comp, out)
}

#plots
max_coop_cost <- c1_coop[c1_coop$time == max(c1_coop$time),]
max_comp_cost <- c1_comp[c1_comp$time == max(c1_comp$time),]
max_coop_cost <- max_coop_cost[,c(4,5,8)]
max_comp_cost <- max_comp_cost[,c(4,5,8)]
max_comp_cost$label <- "comp"
max_coop_cost$label <- "coop"
max <- rbind(max_coop_cost, max_comp_cost)
melted <- melt(max, id = c("label", "cost"))
plot <- melted %>%
  ggplot(aes(x=cost, y = log10(value), color = variable))+
  geom_line(size = 2)+
  facet_wrap(~label)+
  theme_bw()+
  ylab("Equilibrium Phage Density (Log10)")+
  xlab("Fold-Increase in Specialist Infectivity")+
  theme(axis.title.y = element_text(face = "bold"))+
  theme(axis.title.x = element_text(face = "bold"))+
  theme(legend.title = element_text(face = "bold"))
plot
```

Here, on competing hosts, increasing the rate of consumption actually makes the specialist a worse competitor; when advantage is <1x, then the specialist and generalist have roughly equivalent densities at equilibrium, but this diverges as the specialist gets faster and faster at consuming its host. Again, this is likely the result of tearing through its host population too quickly. On cooperating hosts, there is not a rate of consumption that will ever favor the specialist. In this case, the generalist always prevails. 

## Summary

In the resource-explicit model, it is fairly clear that competing hosts tend to select for generalism, while cooperating hosts tend to select for specialism. Importantly, how the cost of generalism is imposed makes a difference for these results: if it is adjusted as attachment rate, this tends to favor the generalist, while burst size tends to favor the specialist. However, considering these results holistically, and assuming that biologically a cost of generalism is likely the result of changes in both of these parameters simultaneously, a few takeways emerge. When hosts are competing, an increase in burst size has an asymptotically limited benefit for the specialist, while an increase in attachment rate has diminishing returns. When hosts are cooperating, increasing attachment rate has an asymptotically limited benefit for the specialist, but a significant benefit when burst size is increased. On average, then, it seems reasonable to conclude that breaking things down by type of cost actually reinforces the sense that competing hosts select for generalism and cooperating hosts for specialism.

The results of the LV models at first look quite a bit different, but reveal the same fundamental results. When hosts are cooperating, increasing the rate of consumption never favors the specialist; on cooperating hosts, a signficant productivity advantage is needed to select for the specialist. When hosts are competing, rate of consumption, as in the resource-explicit, has diminishing returns. Having a lower rate of consumption allows the specialist to roughly match the density of the generalist phage, but as the advantage approaches 1x, the specialist is selected against. Productivity never favors the specialist when hosts are competing, regardless of advantage. The overall trends are not that divergent from the results of the resource-explicit model. The case that might favor a specialist on competing hosts would be if a specialist has a comparatively lower rate of consumption but a higher productivity. On cooperating hosts, a specialist would need to have a fairly high productivity advantage, with the rate of consumption being irrelevant. More than anything, the LV model underscores the relative difficulty of selecting for specialism at all; the trade-offs of generalism must be significant. 

Altogether, the results of these models reinforce the idea that host ecology does make a difference for selection on host range, but that other biological details are necessary to understand the full picture.